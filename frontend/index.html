<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dynamic and Static Tile Viewer</title>
    <!-- Load Tailwind CSS for utility styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                    },
                }
            }
        }
    </script>
    <!-- Load MapLibre GL JS -->
    <script src='https://unpkg.com/maplibre-gl@4.3.2/dist/maplibre-gl.js'></script>
    <link href='https://unpkg.com/maplibre-gl@4.3.2/dist/maplibre-gl.css' rel='stylesheet' />
    
    <style>
        /* Ensure the map occupies the entire viewport */
        #map {
            position: absolute;
            top: 0;
            bottom: 0;
            width: 100%;
            height: 100%;
        }
    </style>
</head>
<body class="font-sans antialiased overflow-hidden">

    <div id="map" class="shadow-lg"></div>

    <div class="fixed top-4 left-1/2 -translate-x-1/2 z-10 bg-white p-3 rounded-xl shadow-2xl border border-blue-100">
        <h1 class="text-lg font-bold text-gray-800">Map Visualization</h1>
        <p class="text-sm text-gray-600">Loading map style from <code class="bg-gray-100 p-1 rounded">http://localhost:8080</code></p>
    </div>

    <script>
        // Get the base style URL from the TileServer GL endpoint.
        // 'ksa-style' must match the key you defined in config.json's "styles" object.
        const styleUrl = 'http://localhost:8080/styles/ksa-style/style.json';
        
        // Define the initial view properties (based on Riyadh data provided previously)
        const initialCenter = [46.6753, 24.7136];
        const initialZoom = 10;
        
        // Function to initialize the map
        function initializeMap() {
            try {
                const map = new maplibregl.Map({
                    container: 'map', // ID of the map container
                    style: styleUrl,  // Load the complete style from TileServer GL
                    center: initialCenter,
                    zoom: initialZoom,
                    pitch: 0,
                    maxPitch: 85,
                    bearing: 0,
                    // Note: 'localhost:8080' is accessible in the browser context, 
                    // and MapLibre will correctly follow the style's internal URLs (mbtiles://...)
                });

                map.on('load', () => {
                    console.log('Map style loaded successfully. Static tiles and Martin POIs should be visible.');
                    // Example: Add a simple control
                    map.addControl(new maplibregl.NavigationControl(), 'top-right');
                });

                map.on('error', (e) => {
                    console.error('MapLibre GL Error:', e.error);
                    showErrorMessage('Failed to load map or style. Ensure tileserver-gl and martin are running and accessible at localhost:8080 and localhost:3000.');
                });

            } catch (error) {
                console.error('Map Initialization Error:', error);
                showErrorMessage('A critical error occurred during map setup.');
            }
        }

        // Simple message box (instead of alert)
        function showErrorMessage(message) {
            const container = document.getElementById('map');
            const errorBox = document.createElement('div');
            errorBox.className = 'fixed inset-0 bg-red-500 bg-opacity-90 flex items-center justify-center p-6 z-50';
            errorBox.innerHTML = `
                <div class="bg-white p-8 rounded-lg shadow-xl max-w-lg text-center">
                    <h2 class="text-2xl font-bold text-red-600 mb-4">Connection Error</h2>
                    <p class="text-gray-700 mb-6">${message}</p>
                    <p class="text-sm text-gray-500">Check your Docker containers and ensure they are reachable at their ports.</p>
                </div>
            `;
            container.appendChild(errorBox);
        }

        // Initialize the map on window load
        window.onload = initializeMap;       

    </script>
</body>
</html>

